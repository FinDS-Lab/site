<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Location | FINDS Lab — Dongduk Woman's University</title>
  <meta name="description" content="FINDS Lab Location — Dongduk Woman's University College of Business" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700;900&family=Noto+Sans:wght@400;600;700;900&family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- 공통 스타일 -->
  <link rel="stylesheet" href="assets/css/common.css" />
  <!-- 공통 레이아웃(헤더/푸터 주입 + 동작 바인딩) -->
  <script src="assets/js/include-layout.js" defer></script>

  <!-- Kakao Maps SDK (services 포함) -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=2288f6c721287408c4bdc22f994230ad&libraries=services"></script>

  <style>
    /* 이 페이지(로케이션) 전용 스타일만 남겼습니다. 공통 헤더/푸터 스타일은 common.css가 담당 */
    :root{
      --accent: rgb(172, 14, 14);
      --gold:   rgb(214, 177, 77);
      --fg-on-accent:#ffffff;
      --bg:#ffffff;
      --bg-soft:#f8fafc;
      --ring:0 0 0 3px rgba(172,14,14,.25);
    }

    /* Map box */
    #kakao-map-wrap{position:relative; z-index:1;}
    #kakao-map{width:100%; height:460px; border-radius:1rem; overflow:hidden; border:1px solid #e5e7eb;}
    @media (max-width: 640px){
      #kakao-map{height:360px;}
    }

    .info-row{display:flex; align-items:flex-start; gap:.6rem}
    .info-row img{width:18px; height:18px; margin-top:.15rem}
    .copy-btn{display:inline-flex; align-items:center; gap:.35rem; padding:.25rem .55rem; border-radius:.6rem; border:1px solid #e5e7eb; font-weight:700; font-size:.75rem}
    .copy-btn:hover{background:#f8fafc}

    /* error banner over the map */
    .map-error{
      position:absolute; top:8px; left:8px; right:auto;
      background:rgba(255,255,255,.95); border:1px solid #e5e7eb; border-radius:.5rem;
      padding:.5rem .65rem; font-size:.75rem; color:#7f1d1d; font-weight:800; z-index:5;
      box-shadow:0 6px 20px rgba(0,0,0,.08)
    }
  </style>
</head>
<body class="bg-[var(--bg-soft)]">

  <!-- 공통 Header 자동 주입 -->
  <header id="site-header"></header>

  <!-- 본문 -->
  <main class="container-root px-4 mt-6 grid lg:grid-cols-3 gap-6">
    <!-- Map -->
    <div class="lg:col-span-2 card" id="kakao-map-wrap">
      <div id="kakao-map" role="img" aria-label="동덕여자대학교 인문관 위치 지도"></div>
      <div id="mapError" class="map-error" style="display:none;"></div>
      <div class="mt-3 flex items-center justify-between">
        <div class="text-[12px] text-slate-500">Powered by Kakao Maps</div>
        <div class="flex items-center gap-2">
          <button id="btnRecenter" class="copy-btn" title="지도 다시 맞추기">Re-center</button>
          <a id="btnDirections" href="#" target="_blank" rel="noopener noreferrer" class="copy-btn" title="카카오맵 길찾기">Directions</a>
        </div>
      </div>
    </div>

    <!-- Right column: two stacked cards -->
    <aside class="space-y-6">
      <!-- FINDS Lab (331호) -->
      <section class="card">
        <div class="bg-[var(--accent)] text-white text-center font-extrabold rounded-t-lg -m-4 -mb-2 py-3">
          금융데이터사이언스 연구실 <span class="opacity-90">(FINDS Lab.)</span>
        </div>

        <h3 class="mt-4 text-lg font-extrabold text-slate-900">동덕여자대학교 인문관 331호</h3>

        <div class="mt-4 space-y-3">
          <div class="info-row">
            <img src="assets/icons/marker.png" alt="" />
            <div>
              <div class="text-[15px] font-semibold text-slate-900">
                (02748) 서울특별시 성북구 화랑로13길 60 동덕여자대학교 인문관
              </div>
              <div class="text-[12px] text-slate-600">
                (02748) 60, Hwarang-ro 13-gil, Seongbuk-gu, Seoul (Dongduk Women’s Univ. — Humanities Bldg.)
              </div>
              <div class="text-[12px] text-slate-500 mt-1">
                (지번) 하월곡동 23-1
              </div>
              <div class="mt-1">
                <button class="copy-btn" data-copy-addr title="주소 복사">Copy address</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 최인수 교수 연구실 (303호) -->
      <section class="card">
        <div class="bg-[var(--accent)] text-white text-center font-extrabold rounded-t-lg -m-4 -mb-2 py-3">
          최인수 교수 연구실 <span class="opacity-90">(Prf. Insu Choi's Office)</span>
        </div>

        <h3 class="mt-4 text-lg font-extrabold text-slate-900">동덕여자대학교 인문관 303호</h3>

        <div class="mt-4 space-y-3">
          <div class="info-row">
            <img src="assets/icons/marker.png" alt="" />
            <div>
              <div class="text-[15px] font-semibold text-slate-900">
                (02748) 서울특별시 성북구 화랑로13길 60 동덕여자대학교 인문관
              </div>
              <div class="text-[12px] text-slate-600">
                (02748) 60, Hwarang-ro 13-gil, Seongbuk-gu, Seoul (Dongduk Women’s Univ. — Humanities Bldg.)
              </div>
              <div class="text-[12px] text-slate-500 mt-1">
                (지번) 하월곡동 23-1
              </div>
              <div class="mt-1">
                <button class="copy-btn" data-copy-addr title="주소 복사">Copy address</button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </aside>
  </main>

  <!-- 공통 Footer 자동 주입 -->
  <footer id="site-footer" class="mt-10"></footer>

  <script>
    // ===== Kakao Map Setup =====
    const mapEl = document.getElementById('kakao-map');
    const errorEl = document.getElementById('mapError');
    const btnDirections = document.getElementById('btnDirections');
    const btnRecenter = document.getElementById('btnRecenter');

    const FALLBACK = { lat: 37.60584058, lng: 127.04134158, name: '동덕여자대학교' };
    const QUERY_PRIMARY = '동덕여자대학교 인문관';
    const QUERY_ALT1 = '상월곡동 86-78';
    const QUERY_ALT2 = '서울 성북구 화랑로13길 60';

    let map, currentPos;

    function showError(msg){
      errorEl.style.display = 'block';
      errorEl.textContent = msg;
    }

    function initMap(lat, lng, name){
      const pos = new kakao.maps.LatLng(lat, lng);
      currentPos = pos;
      map = new kakao.maps.Map(mapEl, { center: pos, level: 4 });

      const marker = new kakao.maps.Marker({ position: pos });
      marker.setMap(map);

      const iwContent = `
        <div style="padding:8px 10px; font-size:12px; max-width:220px;">
          <div style="font-weight:800; margin-bottom:4px; color:#111827;">${name}</div>
          <div style="color:#374151;">서울 성북구 화랑로13길 60 (지번: 상월곡동 86-78)</div>
          <div style="margin-top:6px;">
            <a href="https://map.kakao.com/link/to/${encodeURIComponent(name)},${lat},${lng}"
               target="_blank" rel="noopener"
               style="color:#ac0e0e; font-weight:800; text-decoration:underline; text-underline-offset:2px;">길찾기</a>
          </div>
        </div>`;
      const infowindow = new kakao.maps.InfoWindow({ position: pos, content: iwContent });
      infowindow.open(map, marker);

      btnDirections.href = `https://map.kakao.com/link/to/${encodeURIComponent(name)},${lat},${lng}`;
    }

    function searchPlaceSequence(){
      const places = new kakao.maps.services.Places();
      const geocoder = new kakao.maps.services.Geocoder();

      places.keywordSearch(QUERY_PRIMARY, (data, status) => {
        if (status === kakao.maps.services.Status.OK && data.length){
          const p = data[0];
          initMap(+p.y, +p.x, p.place_name || '동덕여자대학교 인문관');
        } else {
          geocoder.addressSearch(QUERY_ALT1, (result, status2)=>{
            if (status2 === kakao.maps.services.Status.OK && result[0]){
              initMap(+result[0].y, +result[0].x, '동덕여자대학교 인문관');
            } else {
              geocoder.addressSearch(QUERY_ALT2, (result2, status3)=>{
                if (status3 === kakao.maps.services.Status.OK && result2[0]){
                  initMap(+result2[0].y, +result2[0].x, '동덕여자대학교 인문관');
                } else {
                  showError('지오코딩 실패: 캠퍼스 중심 좌표로 표시합니다.');
                  initMap(FALLBACK.lat, FALLBACK.lng, '동덕여자대학교(캠퍼스)');
                }
              });
            }
          });
        }
      }, { size: 3 });
    }

    try{
      if (!window.kakao || !kakao.maps){
        showError('Kakao Maps SDK 로드 실패: 앱 키 또는 도메인 등록을 확인하세요.');
      }else{
        searchPlaceSequence();
      }
    }catch(e){
      console.error(e);
      showError('지도를 초기화할 수 없습니다.');
    }

    // 주소 복사
    document.querySelectorAll('[data-copy-addr]').forEach(btn=>{
      btn.addEventListener('click', async () => {
        const text = '서울 성북구 화랑로13길 60 (지번: 하월곡동 23-1) — 동덕여자대학교 인문관';
        try{
          await navigator.clipboard.writeText(text);
          const old = btn.textContent;
          btn.textContent = 'Copied!';
          setTimeout(()=> btn.textContent = old, 1200);
        }catch(err){
          alert('복사 실패: 브라우저 권한을 확인하세요.');
        }
      });
    });

    // 지도 다시 맞추기
    btnRecenter.addEventListener('click', () => { if (map && currentPos) map.setCenter(currentPos); });

    console.info('[Kakao Maps] 현재 도메인:', location.origin, '— 카카오 디벨로퍼스(내 애플리케이션 > 플랫폼 > Web)에 등록되어 있어야 합니다.');
  </script>
</body>
</html>
