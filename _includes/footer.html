<footer class="mt-16 border-t border-slate-200 bg-white" aria-label="Site footer" id="siteFooter">
  <div class="max-w-7xl mx-auto px-4 py-10">
    <div class="flex flex-col items-center gap-3">
      <p class="text-center text-sm text-slate-500 font-semibold">
        <a class="link-underline" href="https://scholar.google.com/" target="_blank" rel="noopener">Google Scholar</a>
        <span class="mx-2 text-slate-300">|</span>
        <a class="link-underline" href="https://www.nrf.re.kr/" target="_blank" rel="noopener">한국연구재단</a>
      </p>

      <!-- 방문자 카운터 추가 -->
      <div id="visitor-counter" class="flex items-center gap-4 mt-3 mb-2">
        <div class="flex items-center gap-2 text-xs text-slate-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
            <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
          </svg>
          <span>오늘 방문</span>
          <span id="todayCount" class="font-mono font-semibold text-slate-700">0</span>
        </div>
        <div class="flex items-center gap-2 text-xs text-slate-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 1 1 0 000 2H6a2 2 0 100 4h2a2 2 0 100-4h-.5a1 1 0 000-2H8a2 2 0 012-2h2a2 2 0 012 2v9a2 2 0 01-2 2H6a2 2 0 01-2-2V5z" clip-rule="evenodd"/>
          </svg>
          <span>전체 방문</span>
          <span id="totalCount" class="font-mono font-semibold text-slate-700">0</span>
        </div>
      </div>

      <!-- 실시간 온라인 사용자 수 (선택사항) -->
      <div id="online-users" class="flex items-center gap-2 text-xs text-slate-400 mb-2">
        <span class="relative flex h-2 w-2">
          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
          <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
        </span>
        <span>현재 <span id="onlineCount" class="font-semibold">1</span>명 온라인</span>
      </div>

      <!-- ⬇️ id 추가 (스크립트에서 색 제어) -->
      <p id="copyright" class="mt-1 text-center text-xs text-slate-400">
        Copyright © <span id="year"></span> FINDS Lab. All Rights Reserved.
      </p>
    </div>
  </div>

  <!-- Back to Top -->
  <button id="btnTop" class="fixed bottom-5 right-5 hidden rounded-full border border-slate-300 bg-white/90 backdrop-blur p-3 shadow-md hover:shadow-lg focus:outline-none"
          aria-label="Back to top" title="Back to top">
    <!-- Up icon -->
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-700" viewBox="0 0 24 24" fill="none" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/>
    </svg>
  </button>
</footer>

<!-- Footer styles -->
<style>
  /* 동적 링크 컬러(보색 또는 지정색)를 담는 변수 */
  #siteFooter {
    --link-color: #334155; /* 기본값: slate-700 */
  }

  /* 링크 언더라인 슬라이드 + 동적 색 */
  .link-underline {
    position: relative;
    color: var(--link-color);
    transition: color .2s ease;
  }
  .link-underline::after {
    content: "";
    position: absolute;
    left: 0; bottom: -2px;
    width: 100%; height: 2px;
    background: linear-gradient(90deg, var(--link-color), var(--link-color));
    transform: scaleX(0);
    transform-origin: left;
    transition: transform .2s ease;
    border-radius: 1px;
  }
  .link-underline:hover { color: var(--link-color); }
  .link-underline:hover::after { transform: scaleX(1); }

  /* Back-to-Top 버튼 show/hide 애니메이션 */
  #btnTop {
    opacity: 0;
    transform: translateY(6px);
    transition: opacity .2s ease, transform .2s ease, box-shadow .2s ease;
    z-index: 40;
  }
  #btnTop.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* 방문자 카운터 스타일 */
  #visitor-counter, #online-users {
    opacity: 0;
    animation: fadeInUp 0.6s ease forwards;
    animation-delay: 0.2s;
  }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
    from {
      opacity: 0;
      transform: translateY(10px);
    }
  }

  /* 숫자 카운팅 애니메이션 */
  .counter-animate {
    display: inline-block;
    animation: counterPulse 0.3s ease;
  }

  @keyframes counterPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }

  /* 다크 대비 약간(선택) */
  @media (prefers-color-scheme: dark) {
    footer.bg-white { background-color: #0b0f19; }
    footer .text-slate-500 { color: #cbd5e1; }
    footer .text-slate-400 { color: #94a3b8; }
    footer .text-slate-700 { color: #e2e8f0; }
    #btnTop { background: rgba(15, 23, 42, .85); border-color: #334155; }
    #btnTop svg { color: #e2e8f0; }
  }
</style>

<!-- Footer interactions -->
<script>
  (function () {
    // 연도 자동 갱신
    var y = document.getElementById('year');
    if (y) y.textContent = new Date().getFullYear();

    // ===== 방문자 카운터 로직 =====
    // 로컬 스토리지를 사용한 간단한 구현
    // 실제 구현시에는 서버 API를 사용하는 것을 권장
    
    function initVisitorCounter() {
      var todayEl = document.getElementById('todayCount');
      var totalEl = document.getElementById('totalCount');
      var onlineEl = document.getElementById('onlineCount');
      
      // 오늘 날짜 키 생성
      var today = new Date().toLocaleDateString();
      var todayKey = 'visit_' + today;
      var totalKey = 'visit_total';
      
      // 세션 스토리지로 중복 카운트 방지
      var isNewSession = !sessionStorage.getItem('visited');
      
      if (isNewSession) {
        sessionStorage.setItem('visited', 'true');
        
        // 오늘 방문자 수 증가
        var todayCount = parseInt(localStorage.getItem(todayKey) || '0');
        todayCount++;
        localStorage.setItem(todayKey, todayCount.toString());
        
        // 전체 방문자 수 증가
        var totalCount = parseInt(localStorage.getItem(totalKey) || '0');
        totalCount++;
        localStorage.setItem(totalKey, totalCount.toString());
      }
      
      // 카운터 표시 (애니메이션 효과)
      function animateCounter(element, target) {
        var current = 0;
        var increment = Math.ceil(target / 30);
        var timer = setInterval(function() {
          current += increment;
          if (current >= target) {
            current = target;
            clearInterval(timer);
            element.classList.add('counter-animate');
          }
          element.textContent = current.toLocaleString();
        }, 50);
      }
      
      // 저장된 값 표시
      var todayVisits = parseInt(localStorage.getItem(todayKey) || '0');
      var totalVisits = parseInt(localStorage.getItem(totalKey) || '0');
      
      if (todayEl) animateCounter(todayEl, todayVisits);
      if (totalEl) animateCounter(totalEl, totalVisits);
      
      // 온라인 사용자 수 (시뮬레이션)
      if (onlineEl) {
        var onlineCount = Math.floor(Math.random() * 5) + 1;
        onlineEl.textContent = onlineCount;
        
        // 주기적으로 온라인 수 업데이트 (시뮬레이션)
        setInterval(function() {
          var variance = Math.random() > 0.5 ? 1 : -1;
          onlineCount = Math.max(1, onlineCount + variance);
          onlineCount = Math.min(10, onlineCount);
          onlineEl.textContent = onlineCount;
        }, 30000); // 30초마다 업데이트
      }
      
      // 자정에 오늘 카운터 리셋
      var midnight = new Date();
      midnight.setHours(24, 0, 0, 0);
      var msToMidnight = midnight.getTime() - new Date().getTime();
      setTimeout(function() {
        localStorage.removeItem(todayKey);
        if (todayEl) todayEl.textContent = '0';
      }, msToMidnight);
    }
    
    // 방문자 카운터 초기화
    initVisitorCounter();

    // Back-to-Top
    var btn = document.getElementById('btnTop');
    var showPoint = 240; // px
    var ticking = false;

    function onScroll() {
      if (!btn) return;
      if (window.scrollY > showPoint) {
        btn.classList.add('is-visible');
        btn.classList.remove('hidden');
      } else {
        btn.classList.remove('is-visible');
        btn.classList.add('hidden');
      }
      ticking = false;
    }

    window.addEventListener('scroll', function () {
      if (!ticking) {
        window.requestAnimationFrame(onScroll);
        ticking = true;
      }
    }, { passive: true });

    if (btn) {
      btn.addEventListener('click', function () {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }

    // ===== 색상 유틸 =====
    var footer = document.getElementById('siteFooter');
    var copyrightEl = document.getElementById('copyright');

    function parseCssColor(str) {
      // rgb/rgba
      var rgbMatch = str && str.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)/i);
      if (rgbMatch) {
        return {
          r: Math.min(255, parseInt(rgbMatch[1], 10)),
          g: Math.min(255, parseInt(rgbMatch[2], 10)),
          b: Math.min(255, parseInt(rgbMatch[3], 10))
        };
      }
      // #rrggbb or #rgb
      if (str && str[0] === '#') {
        var hex = str.slice(1);
        if (hex.length === 3) {
          var r = parseInt(hex[0] + hex[0], 16);
          var g = parseInt(hex[1] + hex[1], 16);
          var b = parseInt(hex[2] + hex[2], 16);
          return { r, g, b };
        } else if (hex.length === 6) {
          return {
            r: parseInt(hex.slice(0, 2), 16),
            g: parseInt(hex.slice(2, 4), 16),
            b: parseInt(hex.slice(4, 6), 16),
          };
        }
      }
      return null;
    }

    function rgbToHsl(r, g, b) {
      r /= 255; g /= 255; b /= 255;
      var max = Math.max(r, g, b), min = Math.min(r, g, b);
      var h, s, l = (max + min) / 2;

      if (max === min) {
        h = s = 0;
      } else {
        var d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
          case r: h = (g - b) / d + (g < b ? 6 : 0); break;
          case g: h = (b - r) / d + 2; break;
          case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
      }
      return { h: h * 360, s: s * 100, l: l * 100 };
    }

    function hslToCss(h, s, l) {
      return 'hsl(' + Math.round(h) + ' ' + Math.round(s) + '% ' + Math.round(l) + '%)';
    }

    function computeComplementary(colorStr) {
      var rgb = parseCssColor(colorStr);
      if (!rgb) return null;
      var hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);

      // 보색: hue + 180
      var compH = (hsl.h + 180) % 360;

      // 대비 확보: 너무 연하거나 어두우면 L/S를 조정
      var compS = Math.min(90, Math.max(50, hsl.s));
      var compL = hsl.l;
      if (compL > 70) compL = 45;
      if (compL < 25) compL = 60;

      return hslToCss(compH, compS, compL);
    }

    function isLightBackground(colorStr) {
      var rgb = parseCssColor(colorStr);
      if (!rgb) return false;
      var hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);
      return hsl.l >= 90; // 매우 밝음(거의 흰색)
    }

    // 흰색 배경이면 링크=rgb(172,14,14), 카피라이트=검정; 아니면 보색 유지
    function applyFooterColors() {
      if (!footer) return;
      var bg = getComputedStyle(footer).backgroundColor;

      if (isLightBackground(bg)) {
        // 요구사항: 흰 배경일 때 링크 빨간색(172,14,14), 카피라이트 검정
        footer.style.setProperty('--link-color', 'rgb(172, 14, 14)');
        if (copyrightEl) {
          copyrightEl.style.color = '#000000';
        }
      } else {
        // 그 외 배경: 보색 사용, 카피라이트 색은 기본/다크모드 CSS에 맡김
        var comp = computeComplementary(bg);
        if (comp) footer.style.setProperty('--link-color', comp);
        if (copyrightEl) {
          copyrightEl.style.color = ''; // 리셋 -> 클래스/다크모드 규칙 적용
        }
      }
    }

    // 초기 적용
    applyFooterColors();

    // 다크모드 전환 시 재계산
    var mql = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');
    if (mql && typeof mql.addEventListener === 'function') {
      mql.addEventListener('change', applyFooterColors);
    } else if (mql && typeof mql.addListener === 'function') {
      // Safari 구버전 호환
      mql.addListener(applyFooterColors);
    }

    // 리사이즈 등으로 배경이 바뀔 수 있는 경우 대비
    window.addEventListener('resize', applyFooterColors, { passive: true });
  })();
</script>
