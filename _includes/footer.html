<!-- Google Analytics 4 - 이 부분을 <head> 태그 안에 넣으세요 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RSGEYHWRHR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-RSGEYHWRHR');
</script>

<!-- Footer 전체 코드 -->
<footer class="mt-16 border-t border-slate-200 bg-white" aria-label="Site footer" id="siteFooter">
  <div class="max-w-7xl mx-auto px-4 py-10">
    <div class="flex flex-col items-center gap-3">
      
      <!-- 음악 플레이어 -->
      <div id="musicPlayer" class="mb-4 opacity-0" style="animation: fadeIn 0.5s ease forwards;">
        <div class="flex flex-col gap-2 px-4 py-3 bg-slate-50 rounded-2xl border border-slate-200 shadow-sm" style="min-width: 320px;">
          <!-- 상단 컨트롤 -->
          <div class="flex items-center gap-3">
            <!-- 플레이/일시정지 버튼 -->
            <button id="playPauseBtn" class="p-2 rounded-full bg-white hover:bg-slate-100 transition-colors shadow-sm border border-slate-200" aria-label="Play music">
              <svg id="playIcon" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-slate-700" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
              </svg>
              <svg id="pauseIcon" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-slate-700 hidden" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
              </svg>
            </button>
            
            <!-- 음악 정보 -->
            <div class="flex items-center gap-2 flex-1 min-w-0">
              <div class="music-note-animation">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-slate-500" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M18 3a1 1 0 00-1.196-.98l-10 2A1 1 0 006 5v9.114A4.369 4.369 0 005 14c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V7.82l8-1.6v5.894A4.37 4.37 0 0015 12c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V3z"/>
                </svg>
              </div>
              <span id="musicTitle" class="text-xs text-slate-600 font-medium truncate" style="max-width: 150px;" title="Background Music">Loading...</span>
            </div>
            
            <!-- 볼륨 조절 -->
            <div class="flex items-center gap-2">
              <button id="muteBtn" class="p-1" aria-label="Toggle mute">
                <svg id="volumeIcon" xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-slate-500" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z" clip-rule="evenodd"/>
                </svg>
                <svg id="muteIcon" xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-slate-500 hidden" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
                </svg>
              </button>
              <input type="range" id="volumeSlider" min="0" max="100" value="30" class="w-16 h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer slider">
            </div>
          </div>
          
          <!-- 진행 바 -->
          <div class="flex items-center gap-2">
            <span id="currentTime" class="text-xs text-slate-500 font-mono" style="min-width: 35px;">0:00</span>
            <div class="flex-1 relative">
              <input type="range" id="progressSlider" min="0" max="100" value="0" step="0.1" class="w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer progress-slider">
              <div id="progressBar" class="absolute top-1/2 -translate-y-1/2 left-0 h-1 bg-slate-400 rounded-lg pointer-events-none transition-all duration-100" style="width: 0%"></div>
            </div>
            <span id="duration" class="text-xs text-slate-500 font-mono" style="min-width: 35px;">0:00</span>
          </div>
        </div>
      </div>

      <p class="text-center text-sm text-slate-500 font-semibold">
        <a class="link-underline" href="https://scholar.google.com/" target="_blank" rel="noopener">Google Scholar</a>
        <span class="mx-2 text-slate-300">|</span>
        <a class="link-underline" href="https://www.nrf.re.kr/" target="_blank" rel="noopener">한국연구재단</a>
      </p>

      <!-- 방문자 카운터 -->
      <div id="visitor-counter" class="flex items-center gap-4 mt-3 mb-2">
        <div class="flex items-center gap-2 text-xs text-slate-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
            <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
          </svg>
          <span>오늘 방문</span>
          <span id="todayCount" class="font-mono font-semibold text-slate-700">0</span>
        </div>
        <div class="flex items-center gap-2 text-xs text-slate-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 1 1 0 000 2H6a2 2 0 100 4h2a2 2 0 100-4h-.5a1 1 0 000-2H8a2 2 0 012-2h2a2 2 0 012 2v9a2 2 0 01-2 2H6a2 2 0 01-2-2V5z" clip-rule="evenodd"/>
          </svg>
          <span>전체 방문</span>
          <span id="totalCount" class="font-mono font-semibold text-slate-700">0</span>
        </div>
      </div>

      <p id="copyright" class="mt-1 text-center text-xs text-slate-400">
        Copyright © <span id="year"></span> FINDS Lab. All Rights Reserved.
      </p>
    </div>
  </div>

  <!-- Back to Top -->
  <button id="btnTop" class="fixed bottom-5 right-5 hidden rounded-full border border-slate-300 bg-white/90 backdrop-blur p-3 shadow-md hover:shadow-lg focus:outline-none"
          aria-label="Back to top" title="Back to top">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-700" viewBox="0 0 24 24" fill="none" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/>
    </svg>
  </button>
</footer>

<!-- YouTube IFrame API를 위한 div (숨김) -->
<div id="youtube-player" style="display: none;"></div>

<!-- Footer styles -->
<style>
  /* 동적 링크 컬러 변수 */
  #siteFooter {
    --link-color: #334155;
  }

  /* 음악 플레이어 애니메이션 */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* 음표 애니메이션 */
  .music-note-animation svg {
    animation: musicBounce 2s ease-in-out infinite;
  }
  
  @keyframes musicBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-2px); }
  }
  
  .playing .music-note-animation svg {
    animation: musicPulse 1s ease-in-out infinite;
  }
  
  @keyframes musicPulse {
    0%, 100% { 
      transform: scale(1);
      opacity: 0.7;
    }
    50% { 
      transform: scale(1.2);
      opacity: 1;
    }
  }

  /* 슬라이더 스타일 */
  .slider, .progress-slider {
    -webkit-appearance: none;
    outline: none;
  }
  
  .slider::-webkit-slider-thumb, .progress-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 10px;
    height: 10px;
    background: #475569;
    cursor: pointer;
    border-radius: 50%;
    position: relative;
    z-index: 2;
  }
  
  .slider::-moz-range-thumb, .progress-slider::-moz-range-thumb {
    width: 10px;
    height: 10px;
    background: #475569;
    cursor: pointer;
    border-radius: 50%;
    position: relative;
    z-index: 2;
  }
  
  .progress-slider {
    position: relative;
    z-index: 1;
  }
  
  #progressBar {
    z-index: 0;
  }

  /* 링크 언더라인 슬라이드 + 동적 색 */
  .link-underline {
    position: relative;
    color: var(--link-color);
    transition: color .2s ease;
  }
  .link-underline::after {
    content: "";
    position: absolute;
    left: 0; bottom: -2px;
    width: 100%; height: 2px;
    background: linear-gradient(90deg, var(--link-color), var(--link-color));
    transform: scaleX(0);
    transform-origin: left;
    transition: transform .2s ease;
    border-radius: 1px;
  }
  .link-underline:hover { color: var(--link-color); }
  .link-underline:hover::after { transform: scaleX(1); }

  /* Back-to-Top 버튼 show/hide 애니메이션 */
  #btnTop {
    opacity: 0;
    transform: translateY(6px);
    transition: opacity .2s ease, transform .2s ease, box-shadow .2s ease;
    z-index: 40;
  }
  #btnTop.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* 방문자 카운터 스타일 */
  #visitor-counter {
    opacity: 0;
    animation: fadeInUp 0.6s ease forwards;
    animation-delay: 0.2s;
  }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
    from {
      opacity: 0;
      transform: translateY(10px);
    }
  }

  /* 숫자 카운팅 애니메이션 */
  .counter-animate {
    display: inline-block;
    animation: counterPulse 0.3s ease;
  }

  @keyframes counterPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }

  /* 다크모드 대응 */
  @media (prefers-color-scheme: dark) {
    footer.bg-white { background-color: #0b0f19; }
    footer .text-slate-500 { color: #cbd5e1; }
    footer .text-slate-400 { color: #94a3b8; }
    footer .text-slate-700 { color: #e2e8f0; }
    #btnTop { background: rgba(15, 23, 42, .85); border-color: #334155; }
    #btnTop svg { color: #e2e8f0; }
    #musicPlayer > div { 
      background-color: rgba(30, 41, 59, 0.5); 
      border-color: #334155;
    }
    #musicPlayer button {
      background-color: rgba(51, 65, 85, 0.5);
      border-color: #475569;
    }
  }
</style>

<!-- YouTube IFrame API 및 음악 플레이어 스크립트 -->
<script>
  // ===== YouTube 설정 =====
  var YOUTUBE_CONFIG = {
    videoId: null,
    playlistId: 'PL8d7NdcNQoL1tuXOGD7jQYbBeu3bJRjTT',
    shuffle: false
  };

  // YouTube IFrame API 로드
  var tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

  var player;
  var isPlayerReady = false;
  var updateTimer = null;
  var isDragging = false;
  
  // YouTube API Ready 콜백
  function onYouTubeIframeAPIReady() {
    var playerVars = {
      'autoplay': 0,
      'loop': 1,
      'controls': 0,
      'disablekb': 1,
      'fs': 0,
      'modestbranding': 1,
      'rel': 0,
      'showinfo': 0
    };
    
    // 재생목록 설정
    if (YOUTUBE_CONFIG.playlistId) {
      playerVars.listType = 'playlist';
      playerVars.list = YOUTUBE_CONFIG.playlistId;
    } else if (YOUTUBE_CONFIG.videoId) {
      playerVars.playlist = YOUTUBE_CONFIG.videoId;
    }
    
    player = new YT.Player('youtube-player', {
      height: '0',
      width: '0',
      videoId: YOUTUBE_CONFIG.videoId || undefined,
      playerVars: playerVars,
      events: {
        'onReady': onPlayerReady,
        'onStateChange': onPlayerStateChange
      }
    });
  }

  // 플레이어 준비 완료
  function onPlayerReady(event) {
    isPlayerReady = true;
    event.target.setVolume(30);
    event.target.mute();
    
    if (YOUTUBE_CONFIG.playlistId && YOUTUBE_CONFIG.shuffle) {
      event.target.setShuffle(true);
    }
    
    updateVideoTitle();
  }

  // 플레이어 상태 변경
  function onPlayerStateChange(event) {
    var musicPlayer = document.getElementById('musicPlayer');
    var playIcon = document.getElementById('playIcon');
    var pauseIcon = document.getElementById('pauseIcon');
    
    if (event.data == YT.PlayerState.PLAYING) {
      musicPlayer.classList.add('playing');
      playIcon.classList.add('hidden');
      pauseIcon.classList.remove('hidden');
      updateVideoTitle();
      startProgressUpdate();
    } else if (event.data == YT.PlayerState.PAUSED || event.data == YT.PlayerState.ENDED) {
      musicPlayer.classList.remove('playing');
      playIcon.classList.remove('hidden');
      pauseIcon.classList.add('hidden');
      stopProgressUpdate();
    } else if (event.data == YT.PlayerState.CUED) {
      updateVideoTitle();
      resetProgress();
    }
  }
  
  // 비디오 제목 업데이트
  function updateVideoTitle() {
    if (!isPlayerReady || !player) return;
    
    try {
      var videoData = player.getVideoData();
      var titleElement = document.getElementById('musicTitle');
      
      if (videoData && videoData.title && videoData.title !== '') {
        titleElement.textContent = videoData.title;
        titleElement.title = videoData.title;
      } else {
        fetchVideoTitle(YOUTUBE_CONFIG.videoId || player.getVideoData().video_id);
      }
    } catch (e) {
      document.getElementById('musicTitle').textContent = 'Background Music';
    }
  }
  
  // oEmbed API로 제목 가져오기
  function fetchVideoTitle(videoId) {
    if (!videoId) return;
    
    fetch('https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=' + videoId + '&format=json')
      .then(function(response) { return response.json(); })
      .then(function(data) {
        if (data && data.title) {
          var titleElement = document.getElementById('musicTitle');
          titleElement.textContent = data.title;
          titleElement.title = data.title;
        }
      })
      .catch(function(error) {
        document.getElementById('musicTitle').textContent = 'Background Music';
      });
  }
  
  // 시간 포맷
  function formatTime(seconds) {
    if (!seconds || isNaN(seconds)) return '0:00';
    var mins = Math.floor(seconds / 60);
    var secs = Math.floor(seconds % 60);
    return mins + ':' + (secs < 10 ? '0' : '') + secs;
  }
  
  // 진행 상태 업데이트
  function updateProgress() {
    if (!isPlayerReady || !player || isDragging) return;
    
    try {
      var currentTime = player.getCurrentTime();
      var duration = player.getDuration();
      
      if (duration > 0) {
        var percentage = (currentTime / duration) * 100;
        document.getElementById('progressSlider').value = percentage;
        document.getElementById('progressBar').style.width = percentage + '%';
        document.getElementById('currentTime').textContent = formatTime(currentTime);
        document.getElementById('duration').textContent = formatTime(duration);
      }
    } catch (e) {}
  }
  
  function startProgressUpdate() {
    if (!updateTimer) {
      updateTimer = setInterval(updateProgress, 500);
      updateProgress();
    }
  }
  
  function stopProgressUpdate() {
    if (updateTimer) {
      clearInterval(updateTimer);
      updateTimer = null;
    }
  }
  
  function resetProgress() {
    document.getElementById('progressSlider').value = 0;
    document.getElementById('progressBar').style.width = '0%';
    document.getElementById('currentTime').textContent = '0:00';
    document.getElementById('duration').textContent = '0:00';
  }
</script>

<!-- Footer 기능 스크립트 -->
<script>
  (function () {
    // 연도 자동 갱신
    var y = document.getElementById('year');
    if (y) y.textContent = new Date().getFullYear();

    // 음악 플레이어 컨트롤 초기화
    document.addEventListener('DOMContentLoaded', function() {
      // 재생/일시정지 버튼
      var playPauseBtn = document.getElementById('playPauseBtn');
      if (playPauseBtn) {
        playPauseBtn.addEventListener('click', function() {
          if (!isPlayerReady || !player) return;
          
          var state = player.getPlayerState();
          if (state == YT.PlayerState.PLAYING) {
            player.pauseVideo();
          } else {
            player.playVideo();
            if (player.isMuted()) {
              player.unMute();
              document.getElementById('volumeIcon').classList.remove('hidden');
              document.getElementById('muteIcon').classList.add('hidden');
            }
          }
        });
      }
      
      // 음소거 버튼
      var muteBtn = document.getElementById('muteBtn');
      if (muteBtn) {
        muteBtn.addEventListener('click', function() {
          if (!isPlayerReady || !player) return;
          
          if (player.isMuted()) {
            player.unMute();
            document.getElementById('volumeIcon').classList.remove('hidden');
            document.getElementById('muteIcon').classList.add('hidden');
          } else {
            player.mute();
            document.getElementById('volumeIcon').classList.add('hidden');
            document.getElementById('muteIcon').classList.remove('hidden');
          }
        });
      }
      
      // 볼륨 슬라이더
      var volumeSlider = document.getElementById('volumeSlider');
      if (volumeSlider) {
        volumeSlider.addEventListener('input', function() {
          if (!isPlayerReady || !player) return;
          
          player.setVolume(this.value);
          if (this.value == 0) {
            player.mute();
            document.getElementById('volumeIcon').classList.add('hidden');
            document.getElementById('muteIcon').classList.remove('hidden');
          } else {
            if (player.isMuted()) {
              player.unMute();
              document.getElementById('volumeIcon').classList.remove('hidden');
              document.getElementById('muteIcon').classList.add('hidden');
            }
          }
        });
      }
      
      // 진행 바 컨트롤
      var progressSlider = document.getElementById('progressSlider');
      if (progressSlider) {
        progressSlider.addEventListener('mousedown', function() {
          isDragging = true;
        });
        
        progressSlider.addEventListener('input', function() {
          document.getElementById('progressBar').style.width = this.value + '%';
          
          if (isPlayerReady && player) {
            var duration = player.getDuration();
            if (duration > 0) {
              var seekTime = (this.value / 100) * duration;
              document.getElementById('currentTime').textContent = formatTime(seekTime);
            }
          }
        });
        
        progressSlider.addEventListener('change', function() {
          if (!isPlayerReady || !player) {
            isDragging = false;
            return;
          }
          
          var duration = player.getDuration();
          if (duration > 0) {
            var seekTime = (this.value / 100) * duration;
            player.seekTo(seekTime, true);
          }
          
          setTimeout(function() {
            isDragging = false;
          }, 100);
        });
      }
    });

    // ===== 방문자 카운터 로직 =====
    function initVisitorCounter() {
      var todayEl = document.getElementById('todayCount');
      var totalEl = document.getElementById('totalCount');
      
      var koreaTime = new Date(new Date().toLocaleString("en-US", {timeZone: "Asia/Seoul"}));
      var today = koreaTime.toLocaleDateString('ko-KR');
      var todayKey = 'findslab_visit_' + today;
      var totalKey = 'findslab_visit_total';
      
      var isNewSession = !sessionStorage.getItem('findslab_visited');
      
      if (isNewSession) {
        sessionStorage.setItem('findslab_visited', 'true');
        
        var todayCount = parseInt(localStorage.getItem(todayKey) || '0');
        todayCount++;
        localStorage.setItem(todayKey, todayCount.toString());
        
        var totalCount = parseInt(localStorage.getItem(totalKey) || '0');
        totalCount++;
        localStorage.setItem(totalKey, totalCount.toString());
        
        if (typeof gtag !== 'undefined') {
          gtag('event', 'unique_visit', {
            'event_category': 'engagement',
            'event_label': 'visitor_counter',
            'value': 1,
            'total_visits': totalCount,
            'today_visits': todayCount
          });
        }
      }
      
      function animateCounter(element, target) {
        var current = 0;
        var increment = target > 100 ? Math.ceil(target / 30) : 1;
        var duration = target > 100 ? 50 : 30;
        
        var timer = setInterval(function() {
          current += increment;
          if (current >= target) {
            current = target;
            clearInterval(timer);
            element.classList.add('counter-animate');
          }
          element.textContent = current.toLocaleString('ko-KR');
        }, duration);
      }
      
      var todayVisits = parseInt(localStorage.getItem(todayKey) || '0');
      var totalVisits = parseInt(localStorage.getItem(totalKey) || '0');
      
      setTimeout(function() {
        if (todayEl) animateCounter(todayEl, todayVisits);
        if (totalEl) animateCounter(totalEl, totalVisits);
      }, 300);
    }
    
    if (window.location.hostname === 'finds-lab.github.io' || window.location.hostname === 'localhost') {
      initVisitorCounter();
    }

    // Back-to-Top
    var btn = document.getElementById('btnTop');
    var showPoint = 240;
    var ticking = false;

    function onScroll() {
      if (!btn) return;
      if (window.scrollY > showPoint) {
        btn.classList.add('is-visible');
        btn.classList.remove('hidden');
      } else {
        btn.classList.remove('is-visible');
        btn.classList.add('hidden');
      }
      ticking = false;
    }

    window.addEventListener('scroll', function () {
      if (!ticking) {
        window.requestAnimationFrame(onScroll);
        ticking = true;
      }
    }, { passive: true });

    if (btn) {
      btn.addEventListener('click', function () {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }

    // ===== 색상 유틸 =====
    var footer = document.getElementById('siteFooter');
    var copyrightEl = document.getElementById('copyright');

    function parseCssColor(str) {
      var rgbMatch = str && str.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)/i);
      if (rgbMatch) {
        return {
          r: Math.min(255, parseInt(rgbMatch[1], 10)),
          g: Math.min(255, parseInt(rgbMatch[2], 10)),
          b: Math.min(255, parseInt(rgbMatch[3], 10))
        };
      }
      if (str && str[0] === '#') {
        var hex = str.slice(1);
        if (hex.length === 3) {
          var r = parseInt(hex[0] + hex[0], 16);
          var g = parseInt(hex[1] + hex[1], 16);
          var b = parseInt(hex[2] + hex[2], 16);
          return { r, g, b };
        } else if (hex.length === 6) {
          return {
            r: parseInt(hex.slice(0, 2), 16),
            g: parseInt(hex.slice(2, 4), 16),
            b: parseInt(hex.slice(4, 6), 16),
          };
        }
      }
      return null;
    }

    function rgbToHsl(r, g, b) {
      r /= 255; g /= 255; b /= 255;
      var max = Math.max(r, g, b), min = Math.min(r, g, b);
      var h, s, l = (max + min) / 2;

      if (max === min) {
        h = s = 0;
      } else {
        var d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
          case r: h = (g - b) / d + (g < b ? 6 : 0); break;
          case g: h = (b - r) / d + 2; break;
          case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
      }
      return { h: h * 360, s: s * 100, l: l * 100 };
    }

    function hslToCss(h, s, l) {
      return 'hsl(' + Math.round(h) + ' ' + Math.round(s) + '% ' + Math.round(l) + '%)';
    }

    function computeComplementary(colorStr) {
      var rgb = parseCssColor(colorStr);
      if (!rgb) return null;
      var hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);

      var compH = (hsl.h + 180) % 360;
      var compS = Math.min(90, Math.max(50, hsl.s));
      var compL = hsl.l;
      if (compL > 70) compL = 45;
      if (compL < 25) compL = 60;

      return hslToCss(compH, compS, compL);
    }

    function isLightBackground(colorStr) {
      var rgb = parseCssColor(colorStr);
      if (!rgb) return false;
      var hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);
      return hsl.l >= 90;
    }

    function applyFooterColors() {
      if (!footer) return;
      var bg = getComputedStyle(footer).backgroundColor;

      if (isLightBackground(bg)) {
        footer.style.setProperty('--link-color', 'rgb(172, 14, 14)');
        if (copyrightEl) {
          copyrightEl.style.color = '#000000';
        }
      } else {
        var comp = computeComplementary(bg);
        if (comp) footer.style.setProperty('--link-color', comp);
        if (copyrightEl) {
          copyrightEl.style.color = '';
        }
      }
    }

    applyFooterColors();

    var mql = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');
    if (mql && typeof mql.addEventListener === 'function') {
      mql.addEventListener('change', applyFooterColors);
    } else if (mql && typeof mql.addListener === 'function') {
      mql.addListener(applyFooterColors);
    }

    window.addEventListener('resize', applyFooterColors, { passive: true });
  })();
</script>
