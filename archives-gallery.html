---
layout: default
title: gallery
permalink: /archives-gallery.html
---

<!-- ===== Styles ===== -->
<style>
  /* Breadcrumbs (for old image banner & general use) */
  .breadcrumbs{display:flex;flex-wrap:wrap;gap:.5rem;align-items:center;font-size:12px}
  .breadcrumbs a{color:#e5e7eb}
  .breadcrumbs a:hover{text-decoration:underline}
  .breadcrumbs .sep{opacity:.8}

  /* ====== NEW: Animated Gradient Banner (responsive) ====== */
  :root {
    --gold: rgb(214, 177, 77);
    --gold-mid: rgb(234, 197, 97);
    --gold-dark: rgb(194, 157, 57);
  }
  .banner-section {
    background: linear-gradient(135deg,
      var(--gold) 0%,
      var(--gold-mid) 25%,
      var(--gold-dark) 50%,
      var(--gold) 75%,
      var(--gold-mid) 100%);
    background-size: 400% 400%;
    animation: gradientShift 15s ease infinite;
    position: relative;
    overflow: hidden;
    min-height: 200px;
    border-radius: 1rem;
    box-shadow: 0 10px 30px rgba(0,0,0,.08);
    cursor: pointer;
  }
  @keyframes gradientShift {
    0% { background-position: 0% 50%;}
    50% { background-position: 100% 50%;}
    100% { background-position: 0% 50%;}
  }
  .banner-content {
    position: relative;
    z-index: 10;
    padding: 32px 24px;
    display: flex;
    align-items: flex-end;
    justify-content: flex-start;
    min-height: 200px;
  }
  .banner-breadcrumbs {
    display:flex;flex-wrap:wrap;gap:.5rem;align-items:center;
    font-size:13px;font-weight:600;margin-bottom:8px;
  }
  .banner-breadcrumbs a{color:rgba(255,255,255,.92);text-decoration:none;transition:color .2s}
  .banner-breadcrumbs a:hover{color:#fff;text-decoration:underline}
  .banner-breadcrumbs .sep{color:rgba(255,255,255,.75)}
  .banner-breadcrumbs span:not(.sep):not(a){color:#fff;font-weight:700}
  .banner-title {
    font-size: 2.5rem;
    font-weight: 900;
    color: #fff;
    text-shadow: 0 2px 4px rgba(0,0,0,.12);
    letter-spacing: -0.02em;
    margin: 0;
  }

  /* Network burst particles (click effect) */
  .network-burst {
    position:absolute;width:200px;height:200px;pointer-events:none;opacity:0;
    animation: burstAnimation 2s ease-out forwards;
  }
  @keyframes burstAnimation {
    0% {opacity:0;transform:scale(.3) rotate(0deg)}
    30% {opacity:.85}
    100% {opacity:0;transform:scale(2) rotate(180deg)}
  }
  .network-burst svg{width:100%;height:100%}
  .burst-line{stroke:rgba(255,255,255,.7);stroke-width:1.5;fill:none}
  .burst-dot{fill:rgba(255,255,255,.95)}

  /* ===== Search Container ===== */
  .search-container{
    display:flex;align-items:center;gap:12px;flex-wrap:wrap;
    background:#f8fafc;border:1px solid #e5e7eb;border-radius:1rem;padding:16px;margin-top:20px;
  }
  .search-box{flex:1;min-width:0;}
  .search-box input{width:100%;border:1px solid #e5e7eb;border-radius:.6rem;padding:.6rem .8rem;font-size:14px;box-sizing:border-box;}
  .search-count{font-size:13px;color:#6b7280;font-weight:600;background:#fff;padding:.4rem .8rem;border:1px solid #e5e7eb;border-radius:.5rem;white-space:nowrap;}

  /* ===== Gallery Grid ===== */
  .gallery-grid{display:grid;gap:20px;margin-top:24px;grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));}
  @media (max-width: 640px){
    .gallery-grid{grid-template-columns:1fr;gap:16px;}
    .search-count{text-align:center;width:100%;}
  }

  /* ===== Gallery Card ===== */
  .gallery-card{background:#fff;border:1px solid #e5e7eb;border-radius:1rem;overflow:hidden;transition:all .2s;cursor:pointer;display:flex;flex-direction:column;}
  .gallery-card:hover{transform:translateY(-4px);box-shadow:0 12px 32px rgba(0,0,0,.1);}

  /* Thumbnail */
  .gallery-thumb{
    width:100%;height:200px;background-color:#f3f4f6;background-size:cover;background-position:center;background-repeat:no-repeat;position:relative;overflow:hidden;
  }
  .gallery-thumb::after{content:'';position:absolute;inset:0;background:linear-gradient(to bottom, transparent 70%, rgba(0,0,0,.3));opacity:0;transition:opacity .2s;}
  .gallery-card:hover .gallery-thumb::after{opacity:1;}

  /* Card Content */
  .gallery-content{padding:16px;flex:1;display:flex;flex-direction:column;}

  /* Date Badge */
  .gallery-date{
    display:inline-flex;align-items:center;padding:3px 8px;background:#f8fafc;border:1px solid #e5e7eb;border-radius:999px;font-size:11px;font-weight:600;color:#6b7280;margin-bottom:10px;align-self:flex-start;
  }

  /* Title */
  .gallery-title{
    font-size:16px;font-weight:800;color:#111827;line-height:1.4;margin-bottom:8px;
    display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;
  }

  /* Tags */
  .gallery-tags{display:flex;flex-wrap:wrap;gap:6px;margin-top:auto;padding-top:12px;}
  .gallery-tag{display:inline-flex;padding:3px 10px;background:#fff;border:1px solid #e5e7eb;border-radius:999px;font-size:11px;font-weight:600;color:#374151;}

  /* ===== Modal Styles ===== */
  .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:9998;display:none;opacity:0;transition:opacity .3s;}
  .modal-overlay.show{display:block;opacity:1;}
  .modal-panel{
    position:fixed;top:50%;left:50%;transform:translate(-50%, -50%) scale(.95);
    width:90%;max-width:1100px;max-height:85vh;background:#fff;border-radius:1rem;z-index:9999;display:none;opacity:0;transition:all .3s;overflow:hidden;
  }
  .modal-panel.show{display:flex;flex-direction:column;opacity:1;transform:translate(-50%, -50%) scale(1);}
  .modal-header{padding:16px 20px;border-bottom:1px solid #e5e7eb;display:flex;justify-content:space-between;align-items:center;background:#f8fafc;position:sticky;top:0;z-index:1;}
  .modal-title{font-size:18px;font-weight:900;color:#111827;margin-right:8px;}
  .modal-close{width:36px;height:36px;border-radius:.5rem;border:none;background:#fff;color:#111827;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;}
  .modal-close:hover{background:#e5e7eb;}
  .modal-footer{display:none;position:sticky;bottom:0;background:#fff;border-top:1px solid #e5e7eb;padding:10px;z-index:1;}
  .modal-close-mobile{width:100%;padding:12px 16px;border-radius:.75rem;border:1px solid #e5e7eb;background:#111827;color:#fff;font-weight:800;font-size:14px;}
  @media (max-width:640px){.modal-footer{display:block;}}
  .modal-body{flex:1;overflow-y:auto;padding:16px 20px;}
  .modal-meta{display:flex;align-items:center;gap:12px;margin-bottom:16px;flex-wrap:wrap;}
  .modal-date{display:inline-flex;align-items:center;padding:4px 12px;background:#111827;color:#fff;border-radius:999px;font-size:12px;font-weight:700;}
  .modal-tags-container{display:flex;gap:8px;flex-wrap:wrap;}
  .modal-tag{display:inline-flex;padding:4px 12px;background:#f8fafc;border:1px solid #e5e7eb;border-radius:999px;font-size:12px;font-weight:600;color:#374151;}
  .modal-gallery{display:grid;gap:12px;margin-top:12px;}
  .modal-image{position:relative;width:100%;border-radius:.75rem;overflow:hidden;background:#0f172a;}
  .modal-image::before{content:"";display:block;padding-top:56.25%;}
  .modal-image > img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;}

  /* ===== Lightbox ===== */
  .lightbox{position:fixed;inset:0;background:rgba(0,0,0,.95);z-index:10000;display:none;align-items:center;justify-content:center;padding:20px;}
  .lightbox.show{display:flex;}
  .lightbox-image{max-width:100%;max-height:100%;object-fit:contain;}
  .lightbox-close{
    position:absolute;top:20px;right:20px;width:40px;height:40px;background:rgba(255,255,255,.1);
    border:2px solid rgba(255,255,255,.3);border-radius:50%;color:#fff;font-size:24px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;
  }
  .lightbox-close:hover{background:rgba(255,255,255,.2);transform:scale(1.1);}

  /* ===== Empty State ===== */
  .empty-state{grid-column:1/-1;padding:60px 20px;text-align:center;}
  .empty-icon{width:80px;height:80px;margin:0 auto 20px;background:#f3f4f6;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:32px;}
  .empty-title{font-size:18px;font-weight:800;color:#111827;margin-bottom:8px;}
  .empty-text{font-size:14px;color:#6b7280;}

  /* ===== Responsive tweaks ===== */
  @media (max-width:768px){
    .banner-title{font-size:2rem}
    .banner-content{padding:28px 20px;min-height:160px}
    .banner-section{min-height:160px}
  }
  @media (max-width:640px){
    .gallery-thumb{height:160px}
    .gallery-title{font-size:15px}
    .modal-panel{width:100%;height:100%;max-width:100%;max-height:100%;border-radius:0}
  }
  @media (max-width:480px){
    .banner-title{font-size:1.6rem}
    .banner-content{padding:22px 16px;min-height:130px}
    .banner-section{min-height:130px}
  }
</style>

<!-- ===== NEW: Animated Banner (Home ‚Ä∫ Archives ‚Ä∫ Gallery) ===== -->
<section class="max-w-7xl mx-auto px-4 mt-6">
  <div class="banner-section" onclick="createNetworkBurst(event, this)">
    <div class="banner-content">
      <div>
        <nav aria-label="Breadcrumb" class="banner-breadcrumbs">
          <a href="{{ '/' | relative_url }}" onclick="event.stopPropagation()">Home</a>
          <span class="sep">‚Ä∫</span>
          <span>Archives</span>
          <span class="sep">‚Ä∫</span>
          <span aria-current="page">Gallery</span>
        </nav>
        <h1 class="banner-title">Gallery</h1>
      </div>
    </div>
  </div>
</section>

<!-- ===== Search ===== -->
<section class="max-w-7xl mx-auto px-4">
  <div class="search-container">
    <div class="search-box">
      <input id="searchInput" type="text" placeholder="Search by title or tags...">
    </div>
    <div class="search-count" id="searchCount">Loading...</div>
  </div>
</section>

<!-- ===== Gallery Grid (Jekyll Integration) ===== -->
<section class="max-w-7xl mx-auto px-4 pb-8">
  {% comment %} Collect and sort gallery pages {% endcomment %}
  {% assign all_items = site.pages | concat: site.posts %}
  {% assign galleries = "" | split: "" %}
  {% for item in all_items %}
    {% if item.url contains '/gallery/' and item.url != '/archives-gallery.html' and item.title %}
      {% assign galleries = galleries | push: item %}
    {% endif %}
  {% endfor %}
  {% assign dated = "" | split: "" %}
  {% assign undated = "" | split: "" %}
  {% for g in galleries %}
    {% if g.date %}{% assign dated = dated | push: g %}{% else %}{% assign undated = undated | push: g %}{% endif %}
  {% endfor %}
  {% assign dated = dated | sort: 'date' | reverse %}
  {% assign galleries_sorted = dated | concat: undated %}

  {% if galleries_sorted.size == 0 %}
    <div class="empty-state">
      <div class="empty-icon">üì∑</div>
      <div class="empty-title">No gallery items found</div>
      <div class="empty-text">Gallery albums will appear here once created</div>
    </div>
  {% else %}
    <div class="gallery-grid" id="galleryGrid">
      {% for gallery in galleries_sorted %}

        {%- comment -%}
        Build source base path from the file location, not the permalink.
        Example: "/gallery/2025-09-01-1/"
        {%- endcomment -%}
        {% assign base = '/' | append: gallery.path | remove: gallery.name | replace: '//','/' %}
        {% unless base contains '/' and base | slice: -1, 1 == '/' %}
          {% assign base = base | append: '/' %}
        {% endunless %}

        {%- comment -%}
        Resolve thumbnail url from front matter or discovered images under source folder
        {%- endcomment -%}
        {% assign thumb_url = nil %}
        {% if gallery.thumb %}
          {% if gallery.thumb contains '://' or gallery.thumb[0] == '/' %}
            {% assign thumb_url = gallery.thumb | relative_url %}
          {% else %}
            {% assign thumb_url = base | append: gallery.thumb | replace: '//','/' | relative_url %}
          {% endif %}
        {% endif %}

        {%- comment -%}
        Build images_csv from front matter (source-folder based), else discover from static_files under source folder
        {%- endcomment -%}
        {% assign images_csv = '' %}
        {% assign has_images_from_front_matter = false %}

        {% if gallery.images and gallery.images.size > 0 %}
          {% assign has_images_from_front_matter = true %}
          {% for _img in gallery.images %}
            {% assign _img_url = '' %}
            {% if _img contains '://' or _img[0] == '/' %}
              {% assign _img_url = _img | relative_url %}
            {% else %}
              {% assign _img_url = base | append: _img | replace: '//','/' | relative_url %}
            {% endif %}
            {% if images_csv == '' %}
              {% assign images_csv = _img_url %}
            {% else %}
              {% assign images_csv = images_csv | append: ',' | append: _img_url %}
            {% endif %}
          {% endfor %}

          {% if thumb_url == nil %}
            {% assign first_img = images_csv | split: ',' | first %}
            {% assign thumb_url = first_img %}
          {% endif %}
        {% endif %}

        {% if thumb_url == nil or images_csv == '' %}
          {% assign gallery_files = site.static_files | where_exp: "f", "f.path contains base" %}
          {% assign discovered = "" | split: "" %}
          {% for f in gallery_files %}
            {% assign ext = f.extname | downcase %}
            {% if ext == '.jpg' or ext == '.jpeg' or ext == '.png' or ext == '.webp' or ext == '.gif' %}
              {% assign discovered = discovered | push: f %}
            {% endif %}
          {% endfor %}

          {% if discovered.size > 0 %}
            {% if thumb_url == nil %}
              {% assign thumb_url = discovered[0].path | relative_url %}
            {% endif %}

            {% if images_csv == '' %}
              {% for f in discovered %}
                {% assign p = f.path | relative_url %}
                {% if forloop.first %}
                  {% assign images_csv = p %}
                {% else %}
                  {% assign images_csv = images_csv | append: ',' | append: p %}
                {% endif %}
              {% endfor %}
            {% endif %}
          {% endif %}
        {% endif %}

        {% unless thumb_url %}
          {% assign thumb_url = '/assets/img/placeholders/gallery.jpg' | relative_url %}
        {% endunless %}

        {%- comment -%}
        Search text (title + tags)
        {%- endcomment -%}
        {% assign search_text = gallery.title | downcase %}
        {% if gallery.tags %}
          {% assign tags_text = gallery.tags | join: ' ' | downcase %}
          {% assign search_text = search_text | append: ' ' | append: tags_text %}
        {% endif %}

        <div class="gallery-card"
             data-search="{{ search_text | escape }}"
             data-title="{{ gallery.title | escape }}"
             data-date="{{ gallery.date | date: '%b %d, %Y' }}"
             data-tags="{{ gallery.tags | join: ',' | escape }}"
             data-url="{{ gallery.url | relative_url }}"
             data-images="{{ images_csv | escape }}"
             onclick="openGalleryModal(this)">
          <div class="gallery-thumb" style="background-image:url('{{ thumb_url }}')"></div>
          <div class="gallery-content">
            {% if gallery.date %}
              <span class="gallery-date">{{ gallery.date | date: "%b %d, %Y" }}</span>
            {% endif %}
            <h3 class="gallery-title">{{ gallery.title }}</h3>
            {% if gallery.tags and gallery.tags.size > 0 %}
              <div class="gallery-tags">
                {% for tag in gallery.tags %}
                  <span class="gallery-tag">#{{ tag }}</span>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
</section>

<!-- ===== Modal ===== -->
<div class="modal-overlay" id="modalOverlay" onclick="closeGalleryModal()"></div>
<div class="modal-panel" id="modalPanel" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="modal-header">
    <h3 class="modal-title" id="modalTitle">Gallery</h3>
    <button type="button" class="modal-close" aria-label="Close" onclick="closeGalleryModal()">‚úï</button>
  </div>
  <div class="modal-body" id="modalBody"><!-- Content will be inserted here --></div>
  <!-- Mobile friendly close -->
  <div class="modal-footer">
    <button type="button" class="modal-close-mobile" onclick="closeGalleryModal()">Close</button>
  </div>
</div>

<!-- ===== Lightbox ===== -->
<div class="lightbox" id="lightbox" onclick="closeLightbox()">
  <button class="lightbox-close" onclick="closeLightbox()">‚úï</button>
  <img class="lightbox-image" id="lightboxImage" alt="">
</div>

<!-- ===== Scripts ===== -->
<script>
/* ===== NEW: Animated banner click effect ===== */
function createNetworkBurst(event, element) {
  const rect = element.getBoundingClientRect();
  const x = event.clientX - rect.left - 100;
  const y = event.clientY - rect.top - 100;

  const networkDiv = document.createElement('div');
  networkDiv.className = 'network-burst';
  networkDiv.style.left = x + 'px';
  networkDiv.style.top = y + 'px';

  const patterns = [generateHeartNetwork(), generateClubNetwork(), generateSpadeNetwork(), generateDiamondNetwork()];
  const randomPattern = patterns[Math.floor(Math.random() * patterns.length)];
  networkDiv.innerHTML = randomPattern;

  element.appendChild(networkDiv);
  setTimeout(()=>{ element.removeChild(networkDiv); }, 2000);
}
function generateHeartNetwork(){
  let svg = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200">';
  const heartPath='M100,140 C80,120 40,100 40,70 C40,50 55,35 70,35 C85,35 95,45 100,55 C105,45 115,35 130,35 C145,35 160,50 160,70 C160,100 120,120 100,140 Z';
  svg+=`<path d="${heartPath}" fill="none" class="burst-line" stroke-width="2"/>`;
  const nodes=[{x:70,y:35},{x:130,y:35},{x:40,y:70},{x:160,y:70},{x:100,y:140},{x:60,y:50},{x:140,y:50},{x:80,y:90},{x:120,y:90}];
  const connections=[[0,1],[0,2],[1,3],[2,4],[3,4],[0,5],[1,6],[5,7],[6,8],[7,8]];
  connections.forEach(([f,t])=>{svg+=`<line x1="${nodes[f].x}" y1="${nodes[f].y}" x2="${nodes[t].x}" y2="${nodes[t].y}" class="burst-line" opacity="0.5"/>`});
  nodes.forEach(n=>{svg+=`<circle cx="${n.x}" cy="${n.y}" r="${3+Math.random()*2}" class="burst-dot"/>`});
  svg+='</svg>'; return svg;
}
function generateClubNetwork(){
  let svg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200">';
  const circles=[{x:100,y:60,r:25},{x:75,y:85,r:25},{x:125,y:85,r:25}];
  circles.forEach(c=>{svg+=`<circle cx="${c.x}" cy="${c.y}" r="${c.r}" fill="none" class="burst-line" stroke-width="2"/>`});
  svg+=`<line x1="100" y1="100" x2="100" y2="140" class="burst-line" stroke-width="3"/>`;
  const nodes=[];
  circles.forEach(c=>{for(let i=0;i<6;i++){const a=(i*2*Math.PI)/6;nodes.push({x:c.x+c.r*Math.cos(a),y:c.y+c.r*Math.sin(a)})}});
  nodes.push({x:100,y:100},{x:100,y:140});
  for(let i=0;i<nodes.length;i++){for(let j=i+1;j<nodes.length;j++){const dx=nodes[i].x-nodes[j].x, dy=nodes[i].y-nodes[j].y; const dist=Math.sqrt(dx*dx+dy*dy); if(dist<40){svg+=`<line x1="${nodes[i].x}" y1="${nodes[i].y}" x2="${nodes[j].x}" y2="${nodes[j].y}" class="burst-line" opacity="${0.3+(1-dist/40)*0.4}"/>`}}}
  nodes.forEach(n=>{svg+=`<circle cx="${n.x}" cy="${n.y}" r="${2+Math.random()*2}" class="burst-dot"/>`});
  svg+='</svg>'; return svg;
}
function generateSpadeNetwork(){
  let svg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200">';
  const spadePath='M100,50 C80,50 60,65 60,85 C60,105 75,110 85,110 C90,110 95,108 100,105 C105,108 110,110 115,110 C125,110 140,105 140,85 C140,65 120,50 100,50 Z';
  svg+=`<path d="${spadePath}" fill="none" class="burst-line" stroke-width="2"/>`;
  svg+=`<path d="M100,105 L90,130 L110,130 Z" fill="none" class="burst-line" stroke-width="2"/>`;
  svg+=`<line x1="100" y1="130" x2="100" y2="145" class="burst-line" stroke-width="3"/>`;
  const nodes=[{x:100,y:50},{x:75,y:70},{x:125,y:70},{x:60,y:85},{x:140,y:85},{x:85,y:110},{x:115,y:110},{x:100,y:105},{x:90,y:130},{x:110,y:130},{x:100,y:145}];
  const connections=[[0,1],[0,2],[1,3],[2,4],[3,5],[4,6],[5,7],[6,7],[7,8],[7,9],[8,10],[9,10]];
  connections.forEach(([f,t])=>{svg+=`<line x1="${nodes[f].x}" y1="${nodes[f].y}" x2="${nodes[t].x}" y2="${nodes[t].y}" class="burst-line" opacity="0.4"/>`});
  nodes.forEach((n,i)=>{const r=(i===0||i===7)?4:3; svg+=`<circle cx="${n.x}" cy="${n.y}" r="${r}" class="burst-dot"/>`});
  svg+='</svg>'; return svg;
}
function generateDiamondNetwork(){
  let svg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200">';
  const diamondPath='M100,40 L140,100 L100,160 L60,100 Z';
  svg+=`<path d="${diamondPath}" fill="none" class="burst-line" stroke-width="2"/>`;
  svg+=`<line x1="100" y1="40" x2="100" y2="160" class="burst-line" opacity="0.5"/>`;
  svg+=`<line x1="60" y1="100" x2="140" y1="100" class="burst-line" opacity="0.5"/>`;
  svg+=`<line x1="80" y1="70" x2="120" y1="130" class="burst-line" opacity="0.3"/>`;
  svg+=`<line x1="120" y1="70" x2="80" y1="130" class="burst-line" opacity="0.3"/>`;
  const nodes=[{x:100,y:40},{x:140,y:100},{x:100,y:160},{x:60,y:100},{x:100,y:100},{x:80,y:70},{x:120,y:70},{x:80,y:130},{x:120,y:130},{x:120,y:100},{x:80,y:100}];
  for(let i=0;i<4;i++){svg+=`<line x1="${nodes[i].x}" y1="${nodes[i].y}" x2="${nodes[4].x}" y2="${nodes[4].y}" class="burst-line" opacity="0.3"/>`}
  nodes.forEach((n,i)=>{const r=i<4?4:(i===4?5:2.5); svg+=`<circle cx="${n.x}" cy="${n.y}" r="${r}" class="burst-dot" opacity="${i===4?1:.8}"/>`});
  for(let i=0;i<4;i++){const ang=(i*Math.PI)/2; const x=100+30*Math.cos(ang); const y=100+30*Math.sin(ang); svg+=`<circle cx="${x}" cy="${y}" r="1.5" class="burst-dot" opacity="0.6"/>`}
  svg+='</svg>'; return svg;
}

/* Open Gallery Modal with dynamic grid */
function openGalleryModal(card){
  const title = card.dataset.title;
  const date = card.dataset.date;
  const tags = card.dataset.tags ? card.dataset.tags.split(',').filter(Boolean) : [];
  const url  = card.dataset.url;
  const images = card.dataset.images ? card.dataset.images.split(',').filter(Boolean) : [];

  document.getElementById('modalTitle').textContent = title;

  let bodyContent = '<div class="modal-meta">';
  if (date) bodyContent += `<span class="modal-date">${date}</span>`;
  if (tags.length){
    bodyContent += '<div class="modal-tags-container">';
    tags.forEach(tag => bodyContent += `<span class="modal-tag">#${tag}</span>`);
    bodyContent += '</div>';
  }
  bodyContent += '</div>';

  const n = images.length;
  let cols = 1;
  if (n === 1){ cols = 1; }
  else if (n === 2){ cols = 2; }
  else if (n === 3){ cols = 3; }
  else if (n === 4){ cols = 2; }
  else if (n >= 5){ cols = 3; }

  if (n > 0){
    bodyContent += `<div class="modal-gallery" id="modalGallery" style="grid-template-columns:repeat(${cols}, 1fr);">`;
    images.forEach((img, idx) => {
      bodyContent += `
        <div class="modal-image" onclick="openLightbox('${img}')" role="button" aria-label="Open image ${idx+1}">
          <img src="${img}" alt="" loading="lazy" decoding="async" onerror="this.onerror=null; this.style.display='none';">
        </div>`;
    });
    bodyContent += '</div>';
  } else {
    bodyContent += `
      <div class="empty-state" style="padding:40px 20px;">
        <div class="empty-icon">üñºÔ∏è</div>
        <div class="empty-title">No images available</div>
        <div class="empty-text">Images will be displayed here once uploaded</div>
      </div>`;
  }

  const bodyEl = document.getElementById('modalBody');
  bodyEl.innerHTML = bodyContent;

  if (n === 1){
    const g = document.getElementById('modalGallery');
    if (g){ g.style.maxWidth = '1200px'; g.style.margin = '0 auto'; }
  }

  document.getElementById('modalOverlay').classList.add('show');
  document.getElementById('modalPanel').classList.add('show');
  document.body.style.overflow = 'hidden';

  enableSwipeClose(document.getElementById('modalPanel'));
}

/* Close Gallery Modal */
function closeGalleryModal(){
  document.getElementById('modalOverlay').classList.remove('show');
  document.getElementById('modalPanel').classList.remove('show');
  document.body.style.overflow = '';
}

/* Lightbox */
function openLightbox(imageSrc){
  event.stopPropagation();
  const img = document.getElementById('lightboxImage');
  img.src = imageSrc;
  document.getElementById('lightbox').classList.add('show');
}
function closeLightbox(){
  document.getElementById('lightbox').classList.remove('show');
}

/* ESC handling */
document.addEventListener('keydown', function(e){
  if (e.key === 'Escape'){
    const lb = document.getElementById('lightbox');
    if (lb.classList.contains('show')) closeLightbox();
    else if (document.getElementById('modalPanel').classList.contains('show')) closeGalleryModal();
  }
});

/* Search */
(function(){
  const searchInput = document.getElementById('searchInput');
  const searchCount = document.getElementById('searchCount');
  const galleryGrid = document.getElementById('galleryGrid');
  if (!searchInput || !galleryGrid) return;

  const cards = Array.from(galleryGrid.querySelectorAll('.gallery-card'));
  const totalCount = cards.length;

  function updateCount(visible){ searchCount.textContent = visible + ' of ' + totalCount; }

  function filterGallery(){
    const term = searchInput.value.toLowerCase().trim();
    let visible = 0;
    cards.forEach(card => {
      const text = card.dataset.search || '';
      const match = !term || text.includes(term);
      card.style.display = match ? '' : 'none';
      if (match) visible++;
    });
    updateCount(visible);
    if (visible === 0 && term){
      if (!document.getElementById('searchEmpty')){
        const emptyDiv = document.createElement('div');
        emptyDiv.id = 'searchEmpty';
        emptyDiv.className = 'empty-state';
        emptyDiv.innerHTML = `
          <div class="empty-icon">üîç</div>
          <div class="empty-title">No results found</div>
          <div class="empty-text">Try adjusting your search term</div>`;
        galleryGrid.appendChild(emptyDiv);
      }
    } else {
      const empty = document.getElementById('searchEmpty');
      if (empty) empty.remove();
    }
  }
  updateCount(totalCount);
  searchInput.addEventListener('input', filterGallery);
})();

/* Swipe-down to close (mobile-friendly) */
function enableSwipeClose(panel){
  let startY = null, startX = null, moved = false;
  function onTouchStart(e){ const t = e.touches[0]; startY = t.clientY; startX = t.clientX; moved = false; }
  function onTouchMove(e){
    if (startY === null) return;
    const t = e.touches[0];
    const dy = t.clientY - startY;
    const dx = t.clientX - startX;
    if (Math.abs(dy) > Math.abs(dx) && dy > 30){ moved = true; }
  }
  function onTouchEnd(){ if (moved) closeGalleryModal(); startY = startX = null; moved = false; }
  panel.removeEventListener('touchstart', onTouchStart);
  panel.removeEventListener('touchmove', onTouchMove);
  panel.removeEventListener('touchend', onTouchEnd);
  panel.addEventListener('touchstart', onTouchStart, {passive:true});
  panel.addEventListener('touchmove', onTouchMove, {passive:true});
  panel.addEventListener('touchend', onTouchEnd, {passive:true});
}
</script>
